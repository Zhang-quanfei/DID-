*==============================================================================*
*               Heckman两步法 | 样本选择模型 & 处理效应模型(2)                 *
*                         ——使用公开数据代码进行演示                           *
*==============================================================================*

**# 【说明】

*- 该版代码由微信公众号『DMETP』提供，欢迎关注

*- 可传播分享，但代码中的【说明】部分不可删除，且分享时必须注明来源

*- 来源注明参考：代码由微信公众号『DMETP』提供，版权所有

*- 版权所有，严禁商用！

********************************************************************************

**# 【数据来源】

*- 杜勇等（2021），参见在《中国工业经济》网站（http://ciejournal.ajcass.org/Magazine/show/?id=77795）

**# 【参考文献】

*- 杜勇, 孙帆, 邓旭. 共同机构所有权与企业盈余管理[J]. 中国工业经济, 2021(06): 155-173.

********************************************************************************

*- Stata Version: 16 | 17

*- 定义路径

cd "C:\Users\KEMOSABE\Desktop\heckman"

use 数据.dta, clear

*- 连续变量缩尾处理

winsor2    da1               da2              da11           rem             ///
           coz2              coz3             coz_power      coz_number      ///
           coz22             coz33            coz2_year      coz3_year       ///
           director          djg              auditfees      epcm            ///
           net               institution      size           leverage        ///
           roa               growth           toptenrate     independent     ///
           magpay            boardshare       invrec         analyst,        ///
               cut(1 99) replace

*- 设置控制变量的全局暂元

global CV  institution       size             leverage       roa             ///
           growth            toptenrate       dual           independent     ///
           magpay            boardshare       invrec         analyst         ///
           opin              aud

*- 将控制变量及核心解释变量滞后一期

xtset code year

foreach i of global CV {
        gen Lag`i' = L.`i'
        }

gen Lagcoz1 = L.coz1

*- 设置第一阶段回归控制变量的全局暂元

global CV1 Laginstitution    Lagsize          Lagleverage    Lagroa          ///
           Laggrowth         Lagtoptenrate    Lagdual        Lagindependent  ///
           Lagmagpay         Lagboardshare    Laginvrec      Laganalyst      ///
           Lagopin           Lagaud

**# 一、coz1的基准回归及稳健性检验

*- （1）基准回归

qui: reg da1 coz1 $CV i.year i.industry, r
     est store OLS1

*- （2）处理效应模型（MLE）

qui: etregress da1 $CV i.year i.industry,                                    ///
         treat(coz1 = Lagcoz1 $CV i.year i.industry) nolog vce(robust)
     est store et_ML1

/*
Linear regression with endogenous treatment     Number of obs     =     20,018
Estimator: maximum likelihood                   Wald chi2(31)     =    1485.50
Log pseudolikelihood =  18287.002               Prob > chi2       =     0.0000

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
da1          |
 institution |   .0001648   .0001052     1.57   0.117    -.0000414     .000371
        size |  -.0066258   .0008814    -7.52   0.000    -.0083534   -.0048982
    leverage |   .0237043   .0048317     4.91   0.000     .0142344    .0331742
         roa |  -.2253829   .0170078   -13.25   0.000    -.2587175   -.1920482
      growth |   .0353113   .0023365    15.11   0.000     .0307318    .0398909
  toptenrate |   .0001971   .0000445     4.43   0.000     .0001099    .0002844
        dual |   .0031043   .0015126     2.05   0.040     .0001396     .006069
 independent |   .0040687   .0115344     0.35   0.724    -.0185383    .0266758
      magpay |   .4069487   .1409151     2.89   0.004     .1307602    .6831373
  boardshare |  -.0090979   .0037856    -2.40   0.016    -.0165174   -.0016784
      invrec |   .0183075   .0051727     3.54   0.000     .0081693    .0284458
     analyst |   .0005457    .000082     6.65   0.000     .0003849    .0007065
        opin |  -.0389673   .0040999    -9.50   0.000     -.047003   -.0309316
         aud |  -.0038764   .0012816    -3.02   0.002    -.0063884   -.0013644
             |
        year |
       2009  |  -.0008564   .0043254    -0.20   0.843    -.0093341    .0076213
       2010  |   .0186483   .0049932     3.73   0.000     .0088619    .0284348
       2011  |   .0220373   .0042826     5.15   0.000     .0136435     .030431
       2012  |  -.0158729   .0037267    -4.26   0.000    -.0231771   -.0085688
       2013  |  -.0161189      .0036    -4.48   0.000    -.0231748    -.009063
       2014  |  -.0161046   .0035979    -4.48   0.000    -.0231564   -.0090528
       2015  |  -.0031965   .0037801    -0.85   0.398    -.0106053    .0042122
       2016  |  -.0027102   .0037549    -0.72   0.470    -.0100697    .0046493
       2017  |  -.0153086   .0036145    -4.24   0.000    -.0223928   -.0082243
       2018  |  -.0154719   .0036009    -4.30   0.000    -.0225295   -.0084143
       2019  |  -.0178076   .0035699    -4.99   0.000    -.0248046   -.0108107
             |
    industry |
          2  |  -.0297887   .0105573    -2.82   0.005    -.0504806   -.0090968
          3  |  -.0116159   .0109897    -1.06   0.291    -.0331553    .0099234
          4  |  -.0282726   .0115443    -2.45   0.014    -.0508991   -.0056462
          5  |  -.0434586   .0104201    -4.17   0.000    -.0638816   -.0230356
          6  |  -.0323764   .0107643    -3.01   0.003    -.0534741   -.0112787
             |
      1.coz1 |  -.0067129   .0019325    -3.47   0.001    -.0105006   -.0029253
       _cons |   .2775419   .0214512    12.94   0.000     .2354982    .3195855
-------------+----------------------------------------------------------------
coz1         |
     Lagcoz1 |   3.234637    .041428    78.08   0.000      3.15344    3.315835
 institution |   .0037066   .0029546     1.25   0.210    -.0020843    .0094976
        size |   .1103075   .0245284     4.50   0.000     .0622327    .1583822
    leverage |  -.0127087   .1239879    -0.10   0.918    -.2557205    .2303031
         roa |  -.5487199    .328454    -1.67   0.095    -1.192478    .0950382
      growth |    .083781    .037123     2.26   0.024     .0110212    .1565408
  toptenrate |   .0032139   .0012742     2.52   0.012     .0007165    .0057114
        dual |  -.0820718   .0508186    -1.61   0.106    -.1816744    .0175308
 independent |  -1.012848   .3659513    -2.77   0.006    -1.730099   -.2955967
      magpay |    2.53631   4.014366     0.63   0.528    -5.331703    10.40432
  boardshare |  -1.021367   .1736045    -5.88   0.000    -1.361625   -.6811082
      invrec |  -.1793844   .1334323    -1.34   0.179     -.440907    .0821381
     analyst |  -.0033357   .0025439    -1.31   0.190    -.0083216    .0016502
        opin |   .1161474   .1078862     1.08   0.282    -.0953057    .3276005
         aud |   .0256347   .0394008     0.65   0.515    -.0515895    .1028589
             |
        year |
       2009  |   .0545774   .1108197     0.49   0.622    -.1626253    .2717801
       2010  |   .2064666   .1102673     1.87   0.061    -.0096534    .4225866
       2011  |  -.0294345   .1096026    -0.27   0.788    -.2442517    .1853827
       2012  |   .0080566   .1085939     0.07   0.941    -.2047835    .2208966
       2013  |  -.0643272   .1033437    -0.62   0.534    -.2668772    .1382227
       2014  |  -.0427743    .103273    -0.41   0.679    -.2451857    .1596371
       2015  |  -.0567423   .1105243    -0.51   0.608     -.273366    .1598813
       2016  |  -.0928139   .1030316    -0.90   0.368    -.2947522    .1091244
       2017  |  -.2477218    .106496    -2.33   0.020      -.45645   -.0389935
       2018  |  -.0962982   .1050334    -0.92   0.359    -.3021598    .1095634
       2019  |   .0256564   .0998903     0.26   0.797    -.1701251    .2214378
             |
    industry |
          2  |  -.2286483   .2099405    -1.09   0.276    -.6401241    .1828274
          3  |  -.3286038   .2173325    -1.51   0.131    -.7545676      .09736
          4  |  -.4177377    .259037    -1.61   0.107    -.9254409    .0899654
          5  |    .069847   .2032102     0.34   0.731    -.3284377    .4681318
          6  |   .0932101    .210735     0.44   0.658    -.3198229    .5062431
             |
       _cons |  -4.316258   .5725048    -7.54   0.000    -5.438347   -3.194169
-------------+----------------------------------------------------------------
     /athrho |   .0413626   .0199663     2.07   0.038     .0022294    .0804958
    /lnsigma |  -2.451377   .0118703  -206.51   0.000    -2.474643   -2.428112
-------------+----------------------------------------------------------------
         rho |    .041339   .0199322                      .0022294    .0803224
       sigma |   .0861748   .0010229                      .0841931    .0882032
      lambda |   .0035624   .0017194                      .0001924    .0069323
------------------------------------------------------------------------------
Wald test of indep. eqns. (rho = 0): chi2(1) =     4.29   Prob > chi2 = 0.0383
*/

*- （3）处理效应模型（TwoStep）

qui: etregress da1 $CV i.year i.industry,                                    ///
         treat(coz1 = Lagcoz1 $CV i.year i.industry) twostep
     est store et_2S1

/*
Linear regression with endogenous treatment     Number of obs      =     20018
Estimator: two-step                             Wald chi2(61)      =   3629.46
                                                Prob > chi2        =    0.0000

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
da1          |
 institution |   .0001648   .0000966     1.71   0.088    -.0000245    .0003541
        size |  -.0066256   .0007952    -8.33   0.000    -.0081841   -.0050671
    leverage |   .0237045   .0038194     6.21   0.000     .0162187    .0311904
         roa |  -.2253832   .0098235   -22.94   0.000    -.2446369   -.2061294
      growth |   .0353113   .0011144    31.69   0.000     .0331271    .0374955
  toptenrate |   .0001971    .000043     4.58   0.000     .0001128    .0002814
        dual |   .0031042   .0014823     2.09   0.036     .0001989    .0060095
 independent |   .0040678   .0114332     0.36   0.722    -.0183409    .0264765
      magpay |   .4069558   .1104819     3.68   0.000     .1904153    .6234964
  boardshare |  -.0090989   .0041262    -2.21   0.027     -.017186   -.0010117
      invrec |   .0183072   .0041006     4.46   0.000     .0102702    .0263441
     analyst |   .0005457   .0000836     6.53   0.000     .0003818    .0007096
        opin |  -.0389672   .0030457   -12.79   0.000    -.0449367   -.0329978
         aud |  -.0038764   .0012695    -3.05   0.002    -.0063645   -.0013882
             |
        year |
       2009  |  -.0008564   .0038108    -0.22   0.822    -.0083254    .0066127
       2010  |   .0186484    .003792     4.92   0.000     .0112163    .0260805
       2011  |   .0220373    .003709     5.94   0.000     .0147678    .0293068
       2012  |  -.0158729   .0035715    -4.44   0.000    -.0228729    -.008873
       2013  |  -.0161189   .0035103    -4.59   0.000     -.022999   -.0092388
       2014  |  -.0161047   .0034962    -4.61   0.000     -.022957   -.0092523
       2015  |  -.0031967   .0035138    -0.91   0.363    -.0100836    .0036903
       2016  |  -.0027104   .0035086    -0.77   0.440    -.0095872    .0041665
       2017  |  -.0153088   .0034914    -4.38   0.000    -.0221519   -.0084658
       2018  |  -.0154721   .0034815    -4.44   0.000    -.0222958   -.0086485
       2019  |  -.0178078   .0034585    -5.15   0.000    -.0245864   -.0110293
             |
    industry |
          2  |  -.0297886   .0066066    -4.51   0.000    -.0427372   -.0168399
          3  |  -.0116162   .0069175    -1.68   0.093    -.0251743     .001942
          4  |  -.0282727   .0074022    -3.82   0.000    -.0427807   -.0137646
          5  |  -.0434582   .0064804    -6.71   0.000    -.0561595   -.0307569
          6  |  -.0323759    .006855    -4.72   0.000    -.0458115   -.0189404
             |
        coz1 |  -.0067176   .0021868    -3.07   0.002    -.0110037   -.0024315
       _cons |   .2775378   .0181209    15.32   0.000     .2420215    .3130541
-------------+----------------------------------------------------------------
coz1         |
     Lagcoz1 |   3.235202   .0413025    78.33   0.000     3.154251    3.316153
 institution |   .0036154   .0029089     1.24   0.214     -.002086    .0093168
        size |   .1121405   .0239223     4.69   0.000     .0652536    .1590274
    leverage |  -.0208505   .1217953    -0.17   0.864    -.2595648    .2178638
         roa |  -.5578723   .3217238    -1.73   0.083    -1.188439    .0726948
      growth |   .0879266   .0303994     2.89   0.004     .0283449    .1475083
  toptenrate |   .0032304   .0013442     2.40   0.016     .0005958    .0058649
        dual |   -.079793    .050784    -1.57   0.116    -.1793278    .0197418
 independent |  -1.019378   .3750888    -2.72   0.007    -1.754539   -.2842178
      magpay |    2.68412   3.683406     0.73   0.466    -4.535223    9.903462
  boardshare |  -1.018715   .1736654    -5.87   0.000    -1.359093   -.6783367
      invrec |   -.178663    .132241    -1.35   0.177    -.4378506    .0805247
     analyst |  -.0033943   .0025893    -1.31   0.190    -.0084692    .0016805
        opin |   .1167083   .0995624     1.17   0.241    -.0784304    .3118469
         aud |   .0260504    .040476     0.64   0.520     -.053281    .1053818
             |
        year |
       2009  |   .0515999   .1140643     0.45   0.651     -.171962    .2751618
       2010  |   .2019266    .109724     1.84   0.066    -.0131284    .4169816
       2011  |  -.0315077   .1130668    -0.28   0.781    -.2531146    .1900991
       2012  |   .0078514   .1080623     0.07   0.942    -.2039468    .2196496
       2013  |  -.0658881    .108644    -0.61   0.544    -.2788264    .1470502
       2014  |  -.0454649   .1080572    -0.42   0.674    -.2572531    .1663232
       2015  |  -.0564083   .1072322    -0.53   0.599    -.2665795    .1537629
       2016  |   -.092317   .1085734    -0.85   0.395    -.3051169    .1204829
       2017  |  -.2501913   .1096922    -2.28   0.023    -.4651841   -.0351984
       2018  |  -.0990409   .1078524    -0.92   0.358    -.3104276    .1123459
       2019  |   .0223512   .1059781     0.21   0.833    -.1853622    .2300645
             |
    industry |
          2  |  -.2381904    .204628    -1.16   0.244    -.6392539    .1628731
          3  |  -.3332723   .2179531    -1.53   0.126    -.7604526     .093908
          4  |  -.4154694   .2532426    -1.64   0.101    -.9118158     .080877
          5  |   .0617126   .1984843     0.31   0.756    -.3273095    .4507348
          6  |   .0875193   .2074342     0.42   0.673    -.3190443    .4940829
             |
       _cons |  -4.344332   .5487066    -7.92   0.000    -5.419777   -3.268887
-------------+----------------------------------------------------------------
hazard       |
      lambda |   .0035703    .001916     1.86   0.062    -.0001849    .0073256
-------------+----------------------------------------------------------------
         rho |    0.04143
       sigma |  .08617484
------------------------------------------------------------------------------
*/

*- （4）手工处理（TwoStep）

qui: probit coz1 Lagcoz1 $CV i.year i.industry
     est store First1

predict y1, xb
gen     imr1 =  normalden(y1) / normal(y1)
replace imr1 = -normalden(y1) / normal(-y1) if coz1 == 0

qui: reg da1 coz1 $CV i.year i.industry imr1, r
     est store Second1

*- 结果导出

local   mlist1 "OLS1 et_ML1 et_2S1 First1 Second1"
esttab `mlist1' using coz1的基准回归及稳健性检验.rtf, replace                ///
                b(%6.4f) t(%6.4f)                                            ///
                scalar(N r2_a r2_p) compress nogap                           ///
                star(* 0.1 ** 0.05 *** 0.01)                                 ///
                indicate("Year FE=*.year" "Industry FE=*.industry")          ///
                mtitle(`mlist1')                                             ///
                title("Baseline Regression and Robustness Test of coz1")

/*
Baseline Regression and Robustness Test of coz1
---------------------------------------------------------------------------
                 (1)          (2)          (3)          (4)          (5)   
               LSDV1      et_mle1       et_2s1       first1      second1   
---------------------------------------------------------------------------
main                                                                       
coz1         -0.0048***                -0.0067***                -0.0067***
           (-2.9786)                 (-3.0719)                 (-3.4445)   
institut~n    0.0002       0.0002       0.0002*      0.0036       0.0002   
            (1.5850)     (1.5665)     (1.7065)     (1.2429)     (1.5654)   
size         -0.0066***   -0.0066***   -0.0066***    0.1121***   -0.0066***
           (-7.9796)    (-7.5170)    (-8.3323)     (4.6877)    (-7.5054)   
leverage      0.0212***    0.0237***    0.0237***   -0.0209       0.0237***
            (4.5995)     (4.9060)     (6.2064)    (-0.1712)     (4.9027)   
roa          -0.2110***   -0.2254***   -0.2254***   -0.5579*     -0.2254***
          (-12.8244)   (-13.2518)   (-22.9432)    (-1.7340)   (-13.2449)   
growth        0.0345***    0.0353***    0.0353***    0.0879***    0.0353***
           (15.5953)    (15.1127)    (31.6865)     (2.8924)    (15.1130)   
toptenrate    0.0002***    0.0002***    0.0002***    0.0032**     0.0002***
            (5.4173)     (4.4277)     (4.5837)     (2.4032)     (4.4238)   
dual          0.0028*      0.0031**     0.0031**    -0.0798       0.0031** 
            (1.9385)     (2.0523)     (2.0941)    (-1.5712)     (2.0507)   
independ~t    0.0036       0.0041       0.0041      -1.0194***    0.0041   
            (0.3212)     (0.3527)     (0.3558)    (-2.7177)     (0.3524)   
magpay        0.3756***    0.4069***    0.4070***    2.6841       0.4070***
            (2.9158)     (2.8879)     (3.6835)     (0.7287)     (2.8857)   
boardshare   -0.0024      -0.0091**    -0.0091**    -1.0187***   -0.0091** 
           (-0.6691)    (-2.4033)    (-2.2052)    (-5.8660)    (-2.4013)   
invrec        0.0230***    0.0183***    0.0183***   -0.1787       0.0183***
            (4.6611)     (3.5393)     (4.4646)    (-1.3510)     (3.5365)   
analyst       0.0006***    0.0005***    0.0005***   -0.0034       0.0005***
            (7.1090)     (6.6524)     (6.5269)    (-1.3109)     (6.6451)   
opin         -0.0409***   -0.0390***   -0.0390***    0.1167      -0.0390***
          (-10.2467)    (-9.5044)   (-12.7942)     (1.1722)    (-9.4991)   
aud          -0.0043***   -0.0039***   -0.0039***    0.0261      -0.0039***
           (-3.5288)    (-3.0246)    (-3.0534)     (0.6436)    (-3.0220)   
1.coz1                    -0.0067***                                       
                        (-3.4737)                                          
Lagcoz1                                              3.2352***             
                                                  (78.3295)                
imr1                                                              0.0036*  
                                                                (1.8696)   
_cons         0.2681***    0.2775***    0.2775***   -4.3443***    0.2775***
           (13.4216)    (12.9383)    (15.3159)    (-7.9174)    (12.9241)   
---------------------------------------------------------------------------
coz1                                                                       
Lagcoz1                    3.2346***    3.2352***                          
                        (78.0784)    (78.3295)                             
institut~n                 0.0037       0.0036                             
                         (1.2545)     (1.2429)                             
size                       0.1103***    0.1121***                          
                         (4.4971)     (4.6877)                             
leverage                  -0.0127      -0.0209                             
                        (-0.1025)    (-0.1712)                             
roa                       -0.5487*     -0.5579*                            
                        (-1.6706)    (-1.7340)                             
growth                     0.0838**     0.0879***                          
                         (2.2568)     (2.8924)                             
toptenrate                 0.0032**     0.0032**                           
                         (2.5222)     (2.4032)                             
dual                      -0.0821      -0.0798                             
                        (-1.6150)    (-1.5712)                             
independ~t                -1.0128***   -1.0194***                          
                        (-2.7677)    (-2.7177)                             
magpay                     2.5363       2.6841                             
                         (0.6318)     (0.7287)                             
boardshare                -1.0214***   -1.0187***                          
                        (-5.8833)    (-5.8660)                             
invrec                    -0.1794      -0.1787                             
                        (-1.3444)    (-1.3510)                             
analyst                   -0.0033      -0.0034                             
                        (-1.3113)    (-1.3109)                             
opin                       0.1161       0.1167                             
                         (1.0766)     (1.1722)                             
aud                        0.0256       0.0261                             
                         (0.6506)     (0.6436)                             
_cons                     -4.3163***   -4.3443***                          
                        (-7.5393)    (-7.9174)                             
---------------------------------------------------------------------------
/                                                                          
athrho                     0.0414**                                        
                         (2.0716)                                          
lnsigma                   -2.4514***                                       
                       (-2.1e+02)                                          
---------------------------------------------------------------------------
hazard                                                                     
lambda                                  0.0036*                            
                                      (1.8635)                             
Year FE          Yes          Yes          Yes          Yes          Yes   
Industry~E       Yes          Yes          Yes          Yes          Yes   
---------------------------------------------------------------------------
N              22591        20018        20018        20018        20018   
r2_a          0.1387                                              0.1441   
r2_p                                                 0.6912                
---------------------------------------------------------------------------
t statistics in parentheses
* p<0.1, ** p<0.05, *** p<0.01
*/

**# 二、coz2的基准回归及稳健性检验

*- （1）基准回归

qui: reg da1 coz2 $CV i.year i.industry, r
     est store OLS2

*- （2）样本选择模型（TwoStep）

qui: heckman da1 coz2 $CV i.year i.industry,                                 ///
         select( coz2 = $CV1 ) twostep
     est store he_2S2

/*
Heckman selection model -- two-step estimates   Number of obs     =     20,018
(regression model with sample selection)              Selected    =      2,593
                                                      Nonselected =     17,425

                                                Wald chi2(31)     =     559.43
                                                Prob > chi2       =     0.0000

--------------------------------------------------------------------------------
               |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
da1            |
          coz2 |  -.0208381   .0114122    -1.83   0.068    -.0432055    .0015293
   institution |  -.0001099   .0002544    -0.43   0.666    -.0006085    .0003886
          size |   .0065137   .0025792     2.53   0.012     .0014586    .0115689
      leverage |   .0287133   .0115701     2.48   0.013     .0060363    .0513904
           roa |  -.1696233   .0264688    -6.41   0.000    -.2215012   -.1177455
        growth |   .0406549   .0028657    14.19   0.000     .0350382    .0462716
    toptenrate |   .0005991   .0001313     4.56   0.000     .0003418    .0008563
          dual |    .004107   .0047744     0.86   0.390    -.0052507    .0134647
   independent |  -.1094472   .0341261    -3.21   0.001    -.1763332   -.0425612
        magpay |   .7141059   .3357257     2.13   0.033     .0560956    1.372116
    boardshare |  -.1155465    .030857    -3.74   0.000    -.1760251    -.055068
        invrec |  -.0200946   .0138371    -1.45   0.146    -.0472147    .0070255
       analyst |  -3.14e-06   .0002186    -0.01   0.989    -.0004316    .0004253
          opin |  -.0348136   .0083493    -4.17   0.000     -.051178   -.0184492
           aud |   .0026224   .0036027     0.73   0.467    -.0044387    .0096835
               |
          year |
         2009  |  -.0133637   .0087203    -1.53   0.125    -.0304551    .0037278
         2010  |  -.0023983   .0085558    -0.28   0.779    -.0191672    .0143707
         2011  |    .007618   .0084863     0.90   0.369    -.0090149    .0242508
         2012  |   -.018136   .0082114    -2.21   0.027      -.03423    -.002042
         2013  |  -.0343626   .0082714    -4.15   0.000    -.0505743   -.0181509
         2014  |  -.0268081   .0082289    -3.26   0.001    -.0429364   -.0106798
         2015  |   .0043649   .0082808     0.53   0.598    -.0118652     .020595
         2016  |  -.0049588   .0082864    -0.60   0.550       -.0212    .0112823
         2017  |  -.0219129   .0084003    -2.61   0.009    -.0383771   -.0054486
         2018  |  -.0298953    .008332    -3.59   0.000    -.0462257   -.0135649
         2019  |   -.028234   .0081615    -3.46   0.001    -.0442303   -.0122377
               |
      industry |
            2  |  -.0652461   .0191914    -3.40   0.001    -.1028605   -.0276318
            3  |  -.0279979   .0207284    -1.35   0.177    -.0686249     .012629
            4  |  -.0100713   .0240308    -0.42   0.675    -.0571708    .0370283
            5  |  -.0641525   .0188057    -3.41   0.001     -.101011    -.027294
            6  |  -.0458935   .0192651    -2.38   0.017    -.0836525   -.0081345
               |
         _cons |  -.1057979    .077478    -1.37   0.172     -.257652    .0460562
---------------+----------------------------------------------------------------
coz2           |
Laginstitution |    .000229   .0017509     0.13   0.896    -.0032026    .0036607
       Lagsize |   .1220394   .0129369     9.43   0.000     .0966835    .1473953
   Lagleverage |   .3218294   .0709585     4.54   0.000     .1827532    .4609055
        Lagroa |  -.3267603    .204901    -1.59   0.111    -.7283589    .0748383
     Laggrowth |  -.0533554   .0214025    -2.49   0.013    -.0953036   -.0114072
 Lagtoptenrate |   .0049017   .0008002     6.13   0.000     .0033334    .0064701
       Lagdual |  -.1151072    .030836    -3.73   0.000    -.1755447   -.0546697
Lagindependent |  -1.470211   .2309171    -6.37   0.000      -1.9228   -1.017622
     Lagmagpay |   1.025986   2.201411     0.47   0.641      -3.2887    5.340672
 Lagboardshare |  -1.582939   .1017037   -15.56   0.000    -1.782274   -1.383604
     Laginvrec |  -.6018562   .0724373    -8.31   0.000    -.7438308   -.4598817
    Laganalyst |  -.0040897   .0015752    -2.60   0.009    -.0071769   -.0010024
       Lagopin |   .0822428   .0619452     1.33   0.184    -.0391676    .2036531
        Lagaud |   .0487422   .0246017     1.98   0.048     .0005237    .0969607
         _cons |  -3.507714   .2810605   -12.48   0.000    -4.058582   -2.956845
---------------+----------------------------------------------------------------
/mills         |
        lambda |   .0948201   .0173606     5.46   0.000     .0607939    .1288462
---------------+----------------------------------------------------------------
           rho |    0.84225
         sigma |  .11257936
--------------------------------------------------------------------------------
*/

*- （3）处理效应模型 - 手工处理（TwoStep）

qui: probit coz1 Lagcoz1 $CV i.year i.industry
     est store First2

predict y2, xb
gen     imr2 =  normalden(y2) / normal(y2)
replace imr2 = -normalden(y2) / normal(-y2) if coz2 == 0

qui: reg da1 coz2 $CV i.year i.industry imr2, r
     est store Second2

*- 结果导出

local   mlist2 "OLS2 he_2S2 First2 Second2"
esttab `mlist2' using coz2的基准回归及稳健性检验.rtf, replace                ///
                b(%6.4f) t(%6.4f)                                            ///
                scalar(N r2_a r2_p) compress nogap                           ///
                star(* 0.1 ** 0.05 *** 0.01)                                 ///
                indicate("Year FE=*.year" "Industry FE=*.industry")          ///
                mtitle(`mlist2')                                             ///
                title("Baseline Regression and Robustness Test of coz2")

/*
Baseline Regression and Robustness Test of coz2
--------------------------------------------------------------
                 (1)          (2)          (3)          (4)   
                OLS2       he_2S2       First2      Second2   
--------------------------------------------------------------
main                                                          
coz2         -0.0090***   -0.0208*                  -0.0109***
           (-3.5991)    (-1.8260)                 (-3.8498)   
institut~n    0.0002      -0.0001       0.0036       0.0002   
            (1.5711)    (-0.4321)     (1.2429)     (1.5472)   
size         -0.0066***    0.0065**     0.1121***   -0.0066***
           (-7.9283)     (2.5255)     (4.6877)    (-7.4912)   
leverage      0.0213***    0.0287**    -0.0209       0.0237***
            (4.6120)     (2.4817)    (-0.1712)     (4.9087)   
roa          -0.2110***   -0.1696***   -0.5579*     -0.2253***
          (-12.8242)    (-6.4084)    (-1.7340)   (-13.2397)   
growth        0.0344***    0.0407***    0.0879***    0.0353***
           (15.5849)    (14.1866)     (2.8924)    (15.1052)   
toptenrate    0.0002***    0.0006***    0.0032**     0.0002***
            (5.4342)     (4.5641)     (2.4032)     (4.4256)   
dual          0.0027*      0.0041      -0.0798       0.0031** 
            (1.9266)     (0.8602)    (-1.5712)     (2.0504)   
independ~t    0.0034      -0.1094***   -1.0194***    0.0040   
            (0.3042)    (-3.2071)    (-2.7177)     (0.3470)   
magpay        0.3763***    0.7141**     2.6841       0.4066***
            (2.9216)     (2.1271)     (0.7287)     (2.8833)   
boardshare   -0.0026      -0.1155***   -1.0187***   -0.0092** 
           (-0.7150)    (-3.7446)    (-5.8660)    (-2.4146)   
invrec        0.0229***   -0.0201      -0.1787       0.0182***
            (4.6381)    (-1.4522)    (-1.3510)     (3.5220)   
analyst       0.0006***   -0.0000      -0.0034       0.0005***
            (7.0944)    (-0.0144)    (-1.3109)     (6.6466)   
opin         -0.0408***   -0.0348***    0.1167      -0.0389***
          (-10.2360)    (-4.1696)     (1.1722)    (-9.4915)   
aud          -0.0043***    0.0026       0.0261      -0.0039***
           (-3.5238)     (0.7279)     (0.6436)    (-3.0258)   
Lagcoz1                                 3.2352***             
                                     (78.3295)                
imr2                                                 0.0031*  
                                                   (1.6981)   
_cons         0.2673***   -0.1058      -4.3443***    0.2773***
           (13.3690)    (-1.3655)    (-7.9174)    (12.9075)   
--------------------------------------------------------------
coz2                                                          
Laginsti~n                 0.0002                             
                         (0.1308)                             
Lagsize                    0.1220***                          
                         (9.4334)                             
Laglever~e                 0.3218***                          
                         (4.5355)                             
Lagroa                    -0.3268                             
                        (-1.5947)                             
Laggrowth                 -0.0534**                           
                        (-2.4929)                             
Lagtopte~e                 0.0049***                          
                         (6.1256)                             
Lagdual                   -0.1151***                          
                        (-3.7329)                             
Lagindep~t                -1.4702***                          
                        (-6.3668)                             
Lagmagpay                  1.0260                             
                         (0.4661)                             
Lagboard~e                -1.5829***                          
                       (-15.5642)                             
Laginvrec                 -0.6019***                          
                        (-8.3086)                             
Laganalyst                -0.0041***                          
                        (-2.5964)                             
Lagopin                    0.0822                             
                         (1.3277)                             
Lagaud                     0.0487**                           
                         (1.9813)                             
_cons                     -3.5077***                          
                       (-12.4803)                             
--------------------------------------------------------------
/mills                                                        
lambda                     0.0948***                          
                         (5.4618)                             
Year FE          Yes          Yes          Yes          Yes   
Industry~E       Yes          Yes          Yes          Yes   
--------------------------------------------------------------
N              22591        20018        20018        20018   
r2_a          0.1388                                 0.1442   
r2_p                                    0.6912                
--------------------------------------------------------------
t statistics in parentheses
* p<0.1, ** p<0.05, *** p<0.01
*/

**# 三、coz3的基准回归及稳健性检验

*- （1）基准回归

qui: reg da1 coz3 $CV i.year i.industry, r
     est store OLS3

*- （2）样本选择模型（TwoStep）

qui: heckman da1 coz3 $CV i.year i.industry,                                 ///
         select( coz3 = $CV1 ) twostep
     est store he_2S3

/*
Heckman selection model -- two-step estimates   Number of obs     =     20,018
(regression model with sample selection)              Selected    =      2,593
                                                      Nonselected =     17,425

                                                Wald chi2(31)     =     565.35
                                                Prob > chi2       =     0.0000

--------------------------------------------------------------------------------
               |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
---------------+----------------------------------------------------------------
da1            |
          coz3 |  -.0289477   .0101954    -2.84   0.005    -.0489303   -.0089651
   institution |  -.0001807   .0002556    -0.71   0.480    -.0006818    .0003203
          size |   .0064753   .0025742     2.52   0.012     .0014299    .0115206
      leverage |   .0288387   .0115456     2.50   0.012     .0062098    .0514676
           roa |  -.1696595   .0264259    -6.42   0.000    -.2214533   -.1178658
        growth |   .0405629   .0028566    14.20   0.000     .0349642    .0461617
    toptenrate |   .0006867   .0001336     5.14   0.000     .0004249    .0009485
          dual |   .0038133   .0047641     0.80   0.423    -.0055242    .0131509
   independent |   -.102616   .0341637    -3.00   0.003    -.1695756   -.0356564
        magpay |   .6967646   .3351861     2.08   0.038     .0398119    1.353717
    boardshare |  -.1252298   .0309977    -4.04   0.000    -.1859841   -.0644756
        invrec |  -.0193277   .0138172    -1.40   0.162    -.0464089    .0077535
       analyst |   .0000139   .0002184     0.06   0.949    -.0004141    .0004419
          opin |  -.0343817   .0083395    -4.12   0.000    -.0507269   -.0180365
           aud |   .0037367    .003603     1.04   0.300    -.0033251    .0107985
               |
          year |
         2009  |  -.0131979    .008712    -1.51   0.130    -.0302731    .0038772
         2010  |  -.0020616   .0085477    -0.24   0.809    -.0188147    .0146915
         2011  |   .0075034   .0084784     0.88   0.376     -.009114    .0241208
         2012  |  -.0185308   .0082058    -2.26   0.024     -.034614   -.0024477
         2013  |  -.0343901    .008234    -4.18   0.000    -.0505285   -.0182517
         2014  |  -.0270535   .0082206    -3.29   0.001    -.0431656   -.0109414
         2015  |   .0043202   .0082659     0.52   0.601    -.0118806     .020521
         2016  |  -.0052572   .0082765    -0.64   0.525    -.0214788    .0109643
         2017  |  -.0227274   .0083999    -2.71   0.007     -.039191   -.0062639
         2018  |  -.0311446   .0083382    -3.74   0.000    -.0474872   -.0148019
         2019  |  -.0293773   .0081693    -3.60   0.000    -.0453889   -.0133657
               |
      industry |
            2  |   -.063645   .0191875    -3.32   0.001    -.1012518   -.0260382
            3  |  -.0258334   .0207253    -1.25   0.213    -.0664543    .0147876
            4  |  -.0094605   .0240138    -0.39   0.694    -.0565267    .0376057
            5  |  -.0619149    .018814    -3.29   0.001    -.0987897   -.0250402
            6  |   -.043296   .0192825    -2.25   0.025     -.081089   -.0055029
               |
         _cons |  -.1193186   .0767585    -1.55   0.120    -.2697624    .0311252
---------------+----------------------------------------------------------------
coz3           |
Laginstitution |    .000229   .0017509     0.13   0.896    -.0032026    .0036607
       Lagsize |   .1220394   .0129369     9.43   0.000     .0966835    .1473953
   Lagleverage |   .3218294   .0709585     4.54   0.000     .1827532    .4609055
        Lagroa |  -.3267603    .204901    -1.59   0.111    -.7283589    .0748383
     Laggrowth |  -.0533554   .0214025    -2.49   0.013    -.0953036   -.0114072
 Lagtoptenrate |   .0049017   .0008002     6.13   0.000     .0033334    .0064701
       Lagdual |  -.1151072    .030836    -3.73   0.000    -.1755447   -.0546697
Lagindependent |  -1.470211   .2309171    -6.37   0.000      -1.9228   -1.017622
     Lagmagpay |   1.025986   2.201411     0.47   0.641      -3.2887    5.340672
 Lagboardshare |  -1.582939   .1017037   -15.56   0.000    -1.782274   -1.383604
     Laginvrec |  -.6018562   .0724373    -8.31   0.000    -.7438308   -.4598817
    Laganalyst |  -.0040897   .0015752    -2.60   0.009    -.0071769   -.0010024
       Lagopin |   .0822428   .0619452     1.33   0.184    -.0391676    .2036531
        Lagaud |   .0487422   .0246017     1.98   0.048     .0005237    .0969607
         _cons |  -3.507714   .2810605   -12.48   0.000    -4.058582   -2.956845
---------------+----------------------------------------------------------------
/mills         |
        lambda |   .0940508   .0173323     5.43   0.000     .0600801    .1280215
---------------+----------------------------------------------------------------
           rho |    0.83959
         sigma |   .1120202
--------------------------------------------------------------------------------
*/

*- （3）处理效应模型 - 手工处理（TwoStep）

qui: probit coz1 Lagcoz1 $CV i.year i.industry
     est store First3

predict y3, xb
gen     imr3 =  normalden(y3) / normal(y3)
replace imr3 = -normalden(y3) / normal(-y3) if coz3 == 0

qui: reg da1 coz3 $CV i.year i.industry imr3, r
     est store Second3

*- 结果导出

local   mlist3 "OLS3 he_2S3 First3 Second3"
esttab `mlist3' using coz3的基准回归及稳健性检验.rtf, replace                ///
                b(%6.4f) t(%6.4f)                                            ///
                scalar(N r2_a r2_p) compress nogap                           ///
                star(* 0.1 ** 0.05 *** 0.01)                                 ///
                indicate("Year FE=*.year" "Industry FE=*.industry")          ///
                mtitle(`mlist3')                                             ///
                title("Baseline Regression and Robustness Test of coz3")

/*
Baseline Regression and Robustness Test of coz3
--------------------------------------------------------------
                 (1)          (2)          (3)          (4)   
                OLS3       he_2S3       First3      Second3   
--------------------------------------------------------------
main                                                          
coz3         -0.0216***   -0.0289***                -0.0239***
           (-4.5438)    (-2.8393)                 (-4.6501)   
institut~n    0.0001      -0.0002       0.0036       0.0002   
            (1.4890)    (-0.7070)     (1.2429)     (1.4522)   
size         -0.0065***    0.0065**     0.1121***   -0.0066***
           (-7.7998)     (2.5154)     (4.6877)    (-7.3965)   
leverage      0.0214***    0.0288**    -0.0209       0.0238***
            (4.6353)     (2.4978)    (-0.1712)     (4.9254)   
roa          -0.2112***   -0.1697***   -0.5579*     -0.2255***
          (-12.8369)    (-6.4202)    (-1.7340)   (-13.2536)   
growth        0.0344***    0.0406***    0.0879***    0.0352***
           (15.5812)    (14.1999)     (2.8924)    (15.0984)   
toptenrate    0.0002***    0.0007***    0.0032**     0.0002***
            (5.6057)     (5.1407)     (2.4032)     (4.6116)   
dual          0.0027*      0.0038      -0.0798       0.0031** 
            (1.8882)     (0.8004)    (-1.5712)     (2.0329)   
independ~t    0.0039      -0.1026***   -1.0194***    0.0047   
            (0.3548)    (-3.0037)    (-2.7177)     (0.4066)   
magpay        0.3777***    0.6968**     2.6841       0.4078***
            (2.9306)     (2.0787)     (0.7287)     (2.8897)   
boardshare   -0.0029      -0.1252***   -1.0187***   -0.0094** 
           (-0.8042)    (-4.0400)    (-5.8660)    (-2.4747)   
invrec        0.0227***   -0.0193      -0.1787       0.0181***
            (4.6046)    (-1.3988)    (-1.3510)     (3.5000)   
analyst       0.0006***    0.0000      -0.0034       0.0005***
            (7.0874)     (0.0636)    (-1.3109)     (6.6612)   
opin         -0.0408***   -0.0344***    0.1167      -0.0389***
          (-10.2228)    (-4.1227)     (1.1722)    (-9.4748)   
aud          -0.0042***    0.0037       0.0261      -0.0038***
           (-3.4459)     (1.0371)     (0.6436)    (-2.9414)   
Lagcoz1                                 3.2352***             
                                     (78.3295)                
imr3                                                 0.0025   
                                                   (1.3916)   
_cons         0.2649***   -0.1193      -4.3443***    0.2752***
           (13.1820)    (-1.5545)    (-7.9174)    (12.7467)   
--------------------------------------------------------------
coz3                                                          
Laginsti~n                 0.0002                             
                         (0.1308)                             
Lagsize                    0.1220***                          
                         (9.4334)                             
Laglever~e                 0.3218***                          
                         (4.5355)                             
Lagroa                    -0.3268                             
                        (-1.5947)                             
Laggrowth                 -0.0534**                           
                        (-2.4929)                             
Lagtopte~e                 0.0049***                          
                         (6.1256)                             
Lagdual                   -0.1151***                          
                        (-3.7329)                             
Lagindep~t                -1.4702***                          
                        (-6.3668)                             
Lagmagpay                  1.0260                             
                         (0.4661)                             
Lagboard~e                -1.5829***                          
                       (-15.5642)                             
Laginvrec                 -0.6019***                          
                        (-8.3086)                             
Laganalyst                -0.0041***                          
                        (-2.5964)                             
Lagopin                    0.0822                             
                         (1.3277)                             
Lagaud                     0.0487**                           
                         (1.9813)                             
_cons                     -3.5077***                          
                       (-12.4803)                             
--------------------------------------------------------------
/mills                                                        
lambda                     0.0941***                          
                         (5.4263)                             
Year FE          Yes          Yes          Yes          Yes   
Industry~E       Yes          Yes          Yes          Yes   
--------------------------------------------------------------
N              22591        20018        20018        20018   
r2_a          0.1389                                 0.1444   
r2_p                                    0.6912                
--------------------------------------------------------------
t statistics in parentheses
* p<0.1, ** p<0.05, *** p<0.01
*/